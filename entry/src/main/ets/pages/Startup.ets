import log from '../common/cycadLog'
import common from '@ohos.app.ability.common';
import router from '@ohos.router';
import data_preferences from '@ohos.data.preferences';

const H_STORE: string = 'cycadStore';

@Entry
@Component
struct Startup {

  /**
   * In low-code mode, do not add anything to the build function, as it will be
   * overwritten by the content generated by the .visual file in the build phase.
   */
  build() {

  }

  onPageShow(){
    log.info("on StartUp page")
    let context = getContext(this) as common.UIAbilityContext;
    let preferences = data_preferences.getPreferences(context, H_STORE);
    log.debug("get Preferences")
    preferences.then((per)=>{
      per.has('uTK',(err,val)=>{
        if(err || !val){
          log.debug("Can not find uTk")
          setTimeout(()=>{
            router.replaceUrl({url:'pages/Login'})
          },2000)
        }else{
          log.debug("find uTK")
          setTimeout(()=>{
            router.replaceUrl({url:'pages/Index'})
          },2000)
        }
      })
    })
  }
}
